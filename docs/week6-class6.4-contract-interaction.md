# Week 6 - Class 6.4: Interacting with FamilyWallet Contract

**Duration:** 3-4 hours
**Prerequisites:** Week 5 complete (FamilyWallet deployed), Class 6.3 complete (Next.js + MetaMask setup)

---

## Overview

You have a DApp UI that connects to MetaMask. Now it's time to make it **do something**! In this class, you'll connect your frontend to the FamilyWallet smart contract deployed on Sepolia, enabling users to:

- View their balance in the contract
- See who's a family member
- Deposit ETH into the family wallet
- Withdraw their balance
- See transaction status in real-time

By the end, you'll have a fully functional DApp where UI actions trigger actual blockchain transactions.

**This is the magic moment** where frontend meets blockchain!

---

## Learning Objectives

By the end of this class, you will be able to:

1. ‚úÖ Copy and use contract ABIs in frontend projects
2. ‚úÖ Create contract instances with ethers.js v6
3. ‚úÖ Call `view` functions (read blockchain state)
4. ‚úÖ Send transactions (write to blockchain)
5. ‚úÖ Handle transaction confirmation UX
6. ‚úÖ Display transaction status (pending/success/failure)
7. ‚úÖ Update UI after transactions complete
8. ‚úÖ Handle errors gracefully (user rejected, insufficient gas)

---

## Key Concepts

### 1. Contract ABI (Application Binary Interface)

**What is an ABI?**
- JSON description of contract's functions, events, errors
- Tells ethers.js how to encode/decode function calls
- Generated by compiler during `npx hardhat build`

**Example ABI entry:**
```json
{
  "name": "deposit",
  "type": "function",
  "stateMutability": "payable",
  "inputs": [],
  "outputs": []
}
```

**Where to find it:**
- Hardhat generates: `artifacts/contracts/FamilyWallet.sol/FamilyWallet.json`
- Contains: ABI + bytecode + metadata

---

### 2. Contract Instance in ethers.js v6

**Creating a contract instance:**
```typescript
const contract = new ethers.Contract(
  contractAddress,  // Where it's deployed
  contractABI,      // How to interact with it
  signerOrProvider  // Who's calling (signer) or just reading (provider)
);
```

**Two modes:**
1. **Read-only (provider):** Call `view` functions (no gas cost)
2. **Read-write (signer):** Send transactions (costs gas, requires MetaMask signature)

**Example:**
```typescript
// Read-only
const provider = new ethers.BrowserProvider(window.ethereum);
const contract = new ethers.Contract(address, abi, provider);
const balance = await contract.getBalance(myAddress); // No transaction

// Read-write
const signer = await provider.getSigner();
const contract = new ethers.Contract(address, abi, signer);
await contract.deposit({ value: ethers.parseEther("0.1") }); // Transaction!
```

---

### 3. View Functions vs Transactions

| Type | Gas Cost | Returns | Speed | Example |
|------|----------|---------|-------|---------|
| **View** | Free | Data immediately | Instant | `getBalance()` |
| **Transaction** | Costs gas | Transaction hash | 10-30 seconds | `deposit()` |

**View functions:**
- Don't modify state
- Return data immediately
- No MetaMask popup
- Example: `balances[address]`, `isMember()`

**Transactions:**
- Modify blockchain state
- Trigger MetaMask popup
- Return transaction hash
- Must wait for confirmation
- Example: `deposit()`, `withdraw()`, `addMember()`

---

### 4. Transaction Lifecycle

**1. User clicks "Deposit"**
```
UI ‚Üí ethers.js ‚Üí MetaMask popup
```

**2. User approves in MetaMask**
```
MetaMask signs ‚Üí Broadcasts to network ‚Üí Returns tx hash
```

**3. Transaction pending**
```
Miners/validators include in block (~10-30 seconds)
```

**4. Transaction confirmed**
```
Block mined ‚Üí UI updates with success
```

**States to handle:**
- **Idle:** Button ready
- **Pending approval:** Waiting for user to sign
- **Pending confirmation:** Waiting for block inclusion
- **Success:** Transaction confirmed
- **Error:** User rejected or transaction reverted

---

### 5. Error Handling

**Common errors:**

| Error Code | Meaning | User Action |
|------------|---------|-------------|
| `ACTION_REJECTED` (4001) | User clicked "Reject" | Normal, show friendly message |
| `INSUFFICIENT_FUNDS` | Not enough ETH for gas | Get more ETH from faucet |
| `UNPREDICTABLE_GAS_LIMIT` | Transaction would revert | Check contract requirements |
| `NETWORK_ERROR` | RPC endpoint down | Retry or switch network |

---

## Hands-On Activities

### Activity 1: Copy Contract ABI to Frontend

**Goal:** Make FamilyWallet's ABI available to your Next.js app.

**Step 1:** Navigate to your Hardhat project:

```powershell
cd C:\Users\vitor410rodrigues\source\repos\FamilyChain
```

**Step 2:** Locate the ABI file:

```powershell
ls artifacts\contracts\FamilyWallet.sol\FamilyWallet.json
```

**Step 3:** Copy the ABI to your Next.js project:

```powershell
mkdir ..\family-wallet-ui\lib\contracts
Copy-Item artifacts\contracts\FamilyWallet.sol\FamilyWallet.json ..\family-wallet-ui\lib\contracts\FamilyWallet.json
```

**Step 4:** Extract just the ABI (the JSON file also contains bytecode, which we don't need):

Create `family-wallet-ui/lib/contracts/FamilyWallet.ts`:

```typescript
// FamilyWallet contract deployed on Sepolia
export const FAMILY_WALLET_ADDRESS = '0xaa8ffF534A8BC8a6e6C8AEad795d5a5E373e716e';

// Import full contract JSON
import FamilyWalletJSON from './FamilyWallet.json';

// Export just the ABI
export const FAMILY_WALLET_ABI = FamilyWalletJSON.abi;
```

**Step 5:** Verify the import works:

```powershell
cd ..\family-wallet-ui
```

Create a test file `test-abi.ts`:

```typescript
import { FAMILY_WALLET_ABI, FAMILY_WALLET_ADDRESS } from './lib/contracts/FamilyWallet';

console.log('Contract Address:', FAMILY_WALLET_ADDRESS);
console.log('ABI Functions:', FAMILY_WALLET_ABI.map((item: any) => item.name));
```

Run it:
```powershell
npx ts-node test-abi.ts
```

**Expected output:**
```
Contract Address: 0xaa8ffF534A8BC8a6e6C8AEad795d5a5E373e716e
ABI Functions: ['addMember', 'deposit', 'getBalance', ...]
```

Delete the test file after verification.

---

### Activity 2: Create Contract Hook

**Goal:** Build a reusable React hook for contract interactions.

**Step 1:** Create hooks directory:

```powershell
mkdir hooks
```

**Step 2:** Create `hooks/useFamilyWallet.ts`:

```typescript
'use client';

import { useState, useEffect } from 'react';
import { ethers } from 'ethers';
import { useWalletStore } from '@/store/useWalletStore';
import { FAMILY_WALLET_ABI, FAMILY_WALLET_ADDRESS } from '@/lib/contracts/FamilyWallet';

export function useFamilyWallet() {
  const { address, isConnected } = useWalletStore();
  const [contractBalance, setContractBalance] = useState<string>('0');
  const [isMember, setIsMember] = useState<boolean>(false);
  const [isLoading, setIsLoading] = useState<boolean>(false);

  // Get contract instance (read-only)
  const getContract = async (needsSigner: boolean = false) => {
    if (typeof window.ethereum === 'undefined') {
      throw new Error('MetaMask not installed');
    }

    const provider = new ethers.BrowserProvider(window.ethereum);

    if (needsSigner) {
      const signer = await provider.getSigner();
      return new ethers.Contract(FAMILY_WALLET_ADDRESS, FAMILY_WALLET_ABI, signer);
    } else {
      return new ethers.Contract(FAMILY_WALLET_ADDRESS, FAMILY_WALLET_ABI, provider);
    }
  };

  // Fetch user's balance in contract
  const fetchContractBalance = async () => {
    if (!address || !isConnected) return;

    try {
      const contract = await getContract(false);
      const balance = await contract.getBalance(address);
      setContractBalance(ethers.formatEther(balance));
    } catch (error) {
      console.error('Failed to fetch contract balance:', error);
    }
  };

  // Check if user is a member
  const fetchMemberStatus = async () => {
    if (!address || !isConnected) return;

    try {
      const contract = await getContract(false);
      const memberStatus = await contract.isMember(address);
      setIsMember(memberStatus);
    } catch (error) {
      console.error('Failed to fetch member status:', error);
    }
  };

  // Deposit ETH into contract
  const deposit = async (amount: string): Promise<boolean> => {
    if (!address || !isConnected) {
      alert('Please connect your wallet');
      return false;
    }

    if (!isMember) {
      alert('You must be a family member to deposit');
      return false;
    }

    setIsLoading(true);

    try {
      const contract = await getContract(true); // Needs signer
      const tx = await contract.deposit({
        value: ethers.parseEther(amount),
      });

      console.log('Transaction sent:', tx.hash);

      // Wait for confirmation
      const receipt = await tx.wait();
      console.log('Transaction confirmed:', receipt.hash);

      // Refresh balance
      await fetchContractBalance();

      alert('Deposit successful! üéâ');
      return true;
    } catch (error: any) {
      console.error('Deposit failed:', error);

      if (error.code === 'ACTION_REJECTED') {
        alert('Transaction rejected by user');
      } else {
        alert('Deposit failed: ' + error.message);
      }

      return false;
    } finally {
      setIsLoading(false);
    }
  };

  // Withdraw ETH from contract
  const withdraw = async (amount: string): Promise<boolean> => {
    if (!address || !isConnected) {
      alert('Please connect your wallet');
      return false;
    }

    if (!isMember) {
      alert('You must be a family member to withdraw');
      return false;
    }

    setIsLoading(true);

    try {
      const contract = await getContract(true); // Needs signer
      const tx = await contract.withdraw(ethers.parseEther(amount));

      console.log('Transaction sent:', tx.hash);

      // Wait for confirmation
      const receipt = await tx.wait();
      console.log('Transaction confirmed:', receipt.hash);

      // Refresh balance
      await fetchContractBalance();

      alert('Withdrawal successful! üí∞');
      return true;
    } catch (error: any) {
      console.error('Withdraw failed:', error);

      if (error.code === 'ACTION_REJECTED') {
        alert('Transaction rejected by user');
      } else if (error.message.includes('InsufficientBalance')) {
        alert('Insufficient balance in contract');
      } else {
        alert('Withdrawal failed: ' + error.message);
      }

      return false;
    } finally {
      setIsLoading(false);
    }
  };

  // Auto-fetch on mount and address change
  useEffect(() => {
    if (isConnected && address) {
      fetchContractBalance();
      fetchMemberStatus();
    }
  }, [isConnected, address]);

  return {
    contractBalance,
    isMember,
    isLoading,
    deposit,
    withdraw,
    refetch: () => {
      fetchContractBalance();
      fetchMemberStatus();
    },
  };
}
```

**Key features:**
- Separates read (provider) and write (signer) operations
- Handles errors gracefully
- Waits for transaction confirmation
- Refreshes data after successful transactions
- Provides loading states

---

### Activity 3: Create Contract Interaction UI

**Goal:** Build UI components for depositing and withdrawing.

**Step 1:** Create `components/FamilyWalletActions.tsx`:

```typescript
'use client';

import { useState } from 'react';
import { useFamilyWallet } from '@/hooks/useFamilyWallet';
import { useWalletStore } from '@/store/useWalletStore';

export default function FamilyWalletActions() {
  const { isConnected } = useWalletStore();
  const { contractBalance, isMember, isLoading, deposit, withdraw } = useFamilyWallet();
  const [depositAmount, setDepositAmount] = useState('');
  const [withdrawAmount, setWithdrawAmount] = useState('');

  const handleDeposit = async () => {
    if (!depositAmount || parseFloat(depositAmount) <= 0) {
      alert('Please enter a valid amount');
      return;
    }

    const success = await deposit(depositAmount);
    if (success) {
      setDepositAmount(''); // Clear input
    }
  };

  const handleWithdraw = async () => {
    if (!withdrawAmount || parseFloat(withdrawAmount) <= 0) {
      alert('Please enter a valid amount');
      return;
    }

    const success = await withdraw(withdrawAmount);
    if (success) {
      setWithdrawAmount(''); // Clear input
    }
  };

  if (!isConnected) {
    return (
      <div className="p-6 bg-gray-100 rounded-lg text-center text-gray-500">
        Connect your wallet to interact with FamilyWallet
      </div>
    );
  }

  if (!isMember) {
    return (
      <div className="p-6 bg-yellow-100 rounded-lg border-l-4 border-yellow-500">
        <p className="font-semibold text-yellow-800">‚ö†Ô∏è Not a Family Member</p>
        <p className="text-sm text-yellow-700 mt-1">
          You must be added as a family member by the contract owner to deposit or withdraw.
        </p>
      </div>
    );
  }

  return (
    <div className="p-6 bg-white rounded-lg shadow-lg space-y-6">
      <h2 className="text-2xl font-bold text-gray-800">FamilyWallet Actions</h2>

      {/* Contract Balance Display */}
      <div className="p-4 bg-blue-50 rounded-lg">
        <p className="text-sm text-gray-600">Your Balance in Contract:</p>
        <p className="text-3xl font-bold text-blue-600">
          {parseFloat(contractBalance).toFixed(4)} ETH
        </p>
      </div>

      {/* Deposit Section */}
      <div className="space-y-2">
        <label className="block text-sm font-semibold text-gray-700">
          Deposit ETH
        </label>
        <div className="flex gap-2">
          <input
            type="number"
            step="0.01"
            min="0"
            placeholder="0.01"
            value={depositAmount}
            onChange={(e) => setDepositAmount(e.target.value)}
            disabled={isLoading}
            className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"
          />
          <button
            onClick={handleDeposit}
            disabled={isLoading}
            className="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {isLoading ? 'Processing...' : 'Deposit'}
          </button>
        </div>
        <p className="text-xs text-gray-500">
          Enter amount in ETH (e.g., 0.01 = 0.01 ETH)
        </p>
      </div>

      {/* Withdraw Section */}
      <div className="space-y-2">
        <label className="block text-sm font-semibold text-gray-700">
          Withdraw ETH
        </label>
        <div className="flex gap-2">
          <input
            type="number"
            step="0.01"
            min="0"
            placeholder="0.01"
            value={withdrawAmount}
            onChange={(e) => setWithdrawAmount(e.target.value)}
            disabled={isLoading}
            className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"
          />
          <button
            onClick={handleWithdraw}
            disabled={isLoading}
            className="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
          />
            {isLoading ? 'Processing...' : 'Withdraw'}
          </button>
        </div>
        <p className="text-xs text-gray-500">
          Maximum: {parseFloat(contractBalance).toFixed(4)} ETH
        </p>
      </div>

      {/* Transaction Status */}
      {isLoading && (
        <div className="p-4 bg-blue-100 rounded-lg border-l-4 border-blue-500">
          <p className="font-semibold text-blue-800">‚è≥ Transaction Pending</p>
          <p className="text-sm text-blue-700 mt-1">
            Please confirm in MetaMask and wait for blockchain confirmation (~15-30 seconds).
          </p>
        </div>
      )}
    </div>
  );
}
```

---

### Activity 4: Update Home Page with Contract Interaction

**Goal:** Add the contract interaction component to your DApp.

**Step 1:** Update `app/page.tsx` to include the new component:

```typescript
import ConnectWalletButton from '@/components/ConnectWalletButton';
import WalletInfo from '@/components/WalletInfo';
import FamilyWalletActions from '@/components/FamilyWalletActions';
import MetaMaskListener from '@/components/MetaMaskListener';

export default function Home() {
  return (
    <>
      <MetaMaskListener />
      <main className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-8">
        <div className="max-w-4xl mx-auto space-y-8">
          {/* Header */}
          <div className="text-center space-y-4">
            <h1 className="text-5xl font-bold text-gray-900">
              FamilyChain DApp
            </h1>
            <p className="text-lg text-gray-600">
              Decentralized Family Finance Platform
            </p>
          </div>

          {/* Connect Wallet Section */}
          <div className="flex justify-center">
            <ConnectWalletButton />
          </div>

          {/* Wallet Info Section */}
          <WalletInfo />

          {/* Contract Interaction Section */}
          <FamilyWalletActions />

          {/* Footer */}
          <div className="text-center text-sm text-gray-500">
            <p>Built with Next.js 15, ethers.js v6, and Zustand</p>
            <p className="mt-1">
              FamilyWallet: {` `}
              <a
                href={`https://sepolia.etherscan.io/address/0xaa8ffF534A8BC8a6e6C8AEad795d5a5E373e716e`}
                target="_blank"
                rel="noopener noreferrer"
                className="text-blue-500 hover:text-blue-700 underline font-mono"
              >
                0xaa8f...716e
              </a>
            </p>
          </div>
        </div>
      </main>
    </>
  );
}
```

---

### Activity 5: Test End-to-End Flow

**Goal:** Verify your full DApp works from UI to blockchain.

**Step 1:** Ensure you're a family member. From your Hardhat project, run the interact script:

```powershell
cd C:\Users\vitor410rodrigues\source\repos\FamilyChain
npx hardhat run scripts/interact-wallet.ts --network sepolia
```

This adds your wallet as a member (if not already).

---

**Step 2:** Start your Next.js development server:

```powershell
cd ..\family-wallet-ui
npm run dev
```

**Step 3:** Open browser: http://localhost:3000

**Expected UI:**
- Connect Wallet button
- After connecting: Wallet info + FamilyWallet Actions

---

**Step 4:** Test Deposit Flow:

1. Enter `0.001` in Deposit field
2. Click "Deposit" button
3. **MetaMask popup appears:**
   - Shows gas estimate
   - Shows total cost (0.001 ETH + gas)
4. Click "Confirm" in MetaMask
5. **UI shows:** "‚è≥ Transaction Pending"
6. **Wait ~15-30 seconds**
7. **Alert:** "Deposit successful! üéâ"
8. **UI updates:** Contract balance increases by 0.001 ETH

---

**Step 5:** Verify on Etherscan:

- Click the contract address link in footer
- Go to "Internal Txns" tab
- Should see your deposit transaction

---

**Step 6:** Test Withdraw Flow:

1. Enter `0.0005` in Withdraw field
2. Click "Withdraw" button
3. Confirm in MetaMask
4. Wait for confirmation
5. Alert: "Withdrawal successful! üí∞"
6. Contract balance decreases

---

**Step 7:** Test Error Handling:

**Scenario A: User Rejection**
1. Click "Deposit"
2. Click "Reject" in MetaMask
3. Alert: "Transaction rejected by user"

**Scenario B: Insufficient Balance**
1. Try to withdraw more than your contract balance
2. MetaMask may show "Transaction would revert"
3. Or transaction reverts with custom error

**Scenario C: Not a Member**
1. Disconnect wallet
2. Connect with a different MetaMask account (one that's NOT a member)
3. Should see: "‚ö†Ô∏è Not a Family Member" warning
4. Deposit/Withdraw buttons disabled

---

## Expected Outputs

By the end of this class, you should have:

1. ‚úÖ Contract ABI copied to Next.js project
2. ‚úÖ `useFamilyWallet` hook working
3. ‚úÖ Deposit/Withdraw UI functional
4. ‚úÖ MetaMask transaction popups appearing
5. ‚úÖ Transactions confirming on Sepolia
6. ‚úÖ UI updating after transactions
7. ‚úÖ Error handling working (rejections, reverts)
8. ‚úÖ Full DApp experience (UI ‚Üí MetaMask ‚Üí Blockchain ‚Üí UI)

---

## Common Issues & Solutions

### Issue 1: "Contract call reverted"

**Symptoms:** Transaction fails with revert error

**Common causes:**
- Not a family member (`NotAMember` error)
- Insufficient balance in contract (`InsufficientBalance`)
- Zero amount (`ZeroAmount`)

**Solution:**
- Check `isMember` status in UI
- Verify contract balance before withdraw
- Add input validation

---

### Issue 2: Transaction Pending Forever

**Symptoms:** "Transaction Pending" never resolves

**Solution:**
- Check MetaMask for pending transaction
- Gas price may be too low (increase in MetaMask)
- Network congestion (wait or speed up)
- Check Etherscan for transaction status

---

### Issue 3: "Insufficient Funds for Gas"

**Symptoms:** MetaMask shows insufficient funds

**Solution:**
- You need ETH for gas (not just the deposit amount)
- Get more Sepolia ETH from faucet
- Try a smaller transaction

---

### Issue 4: ABI Import Errors

**Symptoms:** `Cannot find module './FamilyWallet.json'`

**Solution:**
- Verify file copied: `ls lib/contracts/FamilyWallet.json`
- Check import path matches file location
- Restart Next.js dev server after adding files

---

### Issue 5: Transaction Success But UI Doesn't Update

**Symptoms:** Transaction confirms but balance stays the same

**Solution:**
- Check `refetch()` is called after transaction
- Hard refresh page (Ctrl+Shift+R)
- Add manual refresh button

---

## Self-Assessment Quiz

### Question 1: ABI Purpose
**Q:** What does the ABI tell ethers.js?
<details>
<summary>Click to reveal answer</summary>

**A:** The ABI (Application Binary Interface) tells ethers.js:
- What functions the contract has
- What parameters each function expects
- What types those parameters are
- What the function returns
- Whether the function is view/pure/payable

Without the ABI, ethers.js doesn't know how to encode function calls.
</details>

---

### Question 2: Provider vs Signer
**Q:** When do you need a signer instead of just a provider?
<details>
<summary>Click to reveal answer</summary>

**A:** You need a **signer** when:
- Sending transactions (modifying state)
- Functions that cost gas
- MetaMask must sign the transaction

You only need a **provider** when:
- Reading data (view/pure functions)
- No state changes
- Free operations
</details>

---

### Question 3: Transaction Wait
**Q:** What does `await tx.wait()` do?
<details>
<summary>Click to reveal answer</summary>

**A:** `await tx.wait()` waits for the transaction to be **confirmed** (included in a block).

Without `.wait()`:
- Transaction is broadcast but not confirmed
- May not be mined yet
- State changes not visible

With `.wait()`:
- Waits for block inclusion (~15-30 seconds)
- Returns transaction receipt
- Guarantees state is updated
</details>

---

### Question 4: Payable Functions
**Q:** How do you send ETH with a function call in ethers.js v6?
<details>
<summary>Click to reveal answer</summary>

**A:**
```typescript
await contract.deposit({ value: ethers.parseEther("0.1") });
```

The `{ value: ... }` overrides object specifies how much ETH to send with the transaction.

**Important:** Use `parseEther()` to convert from ETH to wei.
</details>

---

### Question 5: Error Codes
**Q:** What does error code `ACTION_REJECTED` (4001) mean?
<details>
<summary>Click to reveal answer</summary>

**A:** User clicked "Reject" in MetaMask popup.

This is **normal user behavior**, not a bug. Handle gracefully:
```typescript
if (error.code === 'ACTION_REJECTED') {
  alert('Transaction cancelled');
} else {
  // Actual error
}
```
</details>

---

### Question 6: Gas Estimation
**Q:** Does calling a `view` function cost gas?
<details>
<summary>Click to reveal answer</summary>

**A:** **No!** View functions:
- Don't modify state
- Are free when called externally (from UI)
- Return data immediately
- Don't require MetaMask signature

Only transactions (state-changing functions) cost gas.
</details>

---

### Question 7: Refresh Data
**Q:** Why doesn't the UI update automatically after a transaction?
<details>
<summary>Click to reveal answer</summary>

**A:** React doesn't know the blockchain state changed. You must:
1. Wait for transaction confirmation (`await tx.wait()`)
2. Manually refetch data (`fetchContractBalance()`)
3. Or listen to contract events (advanced - Week 7)

**Best practice:** Refetch data in the same function that sends the transaction.
</details>

---

## Key Takeaways

### Most Important Concepts

1. **ABI is the contract's API definition** - required for all interactions
2. **Provider = read, Signer = write** - use the right one
3. **Always wait for confirmation** with `await tx.wait()`
4. **UI must manually refresh** after transactions
5. **Error handling is critical** - users reject transactions often
6. **View functions are free** - transactions cost gas
7. **parseEther() converts ETH to wei** - blockchain uses wei

### Transaction Flow Checklist

Every transaction should:
- [ ] Get signer (not provider)
- [ ] Call contract function with proper parameters
- [ ] Include `{ value: ... }` for payable functions
- [ ] Catch errors (user rejection, revert)
- [ ] Wait for confirmation (`await tx.wait()`)
- [ ] Refetch data to update UI
- [ ] Show loading/success/error states

---

## Reading Assignments

### Ethereum Book
- **Chapter 12:** Decentralized Applications (DApps)
  - Section: "Frontend Interaction with Smart Contracts" (ABI, contract instances)
  - Section: "Handling Transactions" (signing, confirmation, errors)
  - Section: "Event Handling" (listening to contract events - preview for Week 7)
- **Appendix:** Web3.js Tutorial
  - Section: "Calling Contract Functions" (view vs transactions)
  - Section: "Sending Transactions" (gas estimation, nonce management)

**Why this chapter?**
- Chapter 12 covers the **complete DApp architecture** you just built
- Understanding transaction flow is critical for production apps

---

## Week 6 Complete - Self-Assessment Checklist

Before moving to Week 7, verify you can:

### Gas Optimization (Class 6.1)
- [ ] Explain storage vs memory vs calldata
- [ ] Apply variable packing techniques
- [ ] Generate gas reports with Hardhat
- [ ] Identify gas optimization opportunities

### Security (Class 6.2)
- [ ] Install and run Slither
- [ ] Interpret security reports
- [ ] Distinguish false positives from real issues
- [ ] Understand common vulnerabilities (reentrancy, access control)

### Frontend (Class 6.3)
- [ ] Create Next.js 15 projects with TypeScript
- [ ] Connect MetaMask to React apps
- [ ] Manage state with Zustand
- [ ] Handle account/network changes

### Contract Interaction (Class 6.4)
- [ ] Use contract ABIs in frontend
- [ ] Create contract instances with ethers.js v6
- [ ] Call view functions and send transactions
- [ ] Handle transaction lifecycle (pending/success/error)

**If you can do all of the above, you're ready for Week 7!**

---

## Next Steps

**Week 7: Web3 Integration** (~1 week, 4 classes)
- Web3.js and Ethers.js deep dive
- Advanced frontend contract interaction
- Backend blockchain service (Node.js)
- Event listening and real-time updates
- Storing blockchain events in PostgreSQL

**What you'll build:**
- Event listener that syncs blockchain events to database
- Real-time UI updates when transactions occur
- Backend service that monitors your contracts

---

**Class 6.4 Complete!**

**üéâ Week 6 Complete! You've built a full-stack DApp:**
- ‚úÖ Gas-optimized smart contract
- ‚úÖ Security-audited with Slither
- ‚úÖ Modern Next.js frontend
- ‚úÖ MetaMask integration
- ‚úÖ Real blockchain transactions from UI

**Early Win:** Open your DApp, deposit 0.001 ETH, watch MetaMask pop up, confirm the transaction, wait 15 seconds, and see your contract balance increase. **This is what Uniswap, Aave, and every DApp does!** You just built the same architecture!

---

**Next week:** You'll learn how to listen to blockchain events in real-time and build backend services that automatically react to on-chain activity.
